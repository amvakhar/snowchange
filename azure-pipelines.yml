trigger:
- '*'
variables:
  SNOWFLAKE_PASSWORD: '$(SNOWFLAKE_PASSWORD)'
  
steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.6'
- script: python -m pip install --upgrade pip
  displayName: 'Install PIP Update'

- script: python -m pip install snowflake-connector-python
  displayName: 'Install Snowchange'
  
- task: PowerShell@2
  displayName: Add the username as an environment variable so the tests can find it.
  inputs:
    targetType: 'inline'
    script: |
      Write-Host "Making the Snowflake_password available as an environment variable."
      Write-Host "##vso[task.setvariable variable=SNOWFLAKE_PASSWORD;]$(SNOWFLAKE_PASSWORD)"
- 
  script: python snowchange/cli.py -a $(SNOWFLAKE_ACCOUNT) -u $(SNOWFLAKE_USER) -r $(SNOWFLAKE_ROLE) -w $(SNOWFLAKE_WAREHOUSE) -d $(SNOWFLAKE_DATABASE)
  displayName: 'Main Code'